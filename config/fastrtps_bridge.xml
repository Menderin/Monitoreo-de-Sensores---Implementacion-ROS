<?xml version="1.0" encoding="UTF-8" ?>
<!--
    fastrtps_bridge.xml
    Perfil FastRTPS para dos contenedores en la misma red bridge de Docker.

    Problema: En red bridge, el multicast DDS (puerto 7400) puede no funcionar
    dependiendo de la configuración del kernel. Este perfil fuerza unicast y
    lista los peers por nombre de servicio Docker (el DNS interno del bridge
    resuelve 'microros_agent' y 'ros_node' a sus IPs internas).

    Usado por: docker-compose.windows.yml (Docker Desktop / WSL2 Desktop)
    NO se usa en Linux nativo ni WSL2 con Docker nativo (network_mode: host).
-->
<profiles xmlns="http://www.eprosima.com/XMLSchemas/fastRTPS_Profiles">

  <participant profile_name="default_participant" is_default_profile="true">
    <rtps>
      <builtin>

        <!-- Desactivar multicast (no confiable en Docker bridge) -->
        <metatrafficMulticastLocatorList/>

        <!-- Unicast para este participante (puerto lo asigna el OS) -->
        <metatrafficUnicastLocatorList>
          <locator>
            <udpv4>
              <port>0</port>
            </udpv4>
          </locator>
        </metatrafficUnicastLocatorList>

        <!--
          Peers iniciales: los dos servicios del docker-compose.
          Docker bridge DNS resuelve 'microros_agent' y 'ros_node'
          a sus IPs internas automáticamente.
          Puerto 7410 = metatraffic unicast, domainId=0, participantId=0.
        -->
        <initialPeersList>
          <locator>
            <udpv4>
              <address>microros_agent</address>
              <port>7410</port>
            </udpv4>
          </locator>
          <locator>
            <udpv4>
              <address>ros_node</address>
              <port>7410</port>
            </udpv4>
          </locator>
        </initialPeersList>

      </builtin>
    </rtps>
  </participant>

</profiles>
