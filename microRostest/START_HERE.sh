#!/bin/bash

# Script completo para probar el sistema micro-ROS

BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
CYAN='\033[0;36m'
NC='\033[0m'

clear
echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${CYAN}โ                                                           โ${NC}"
echo -e "${CYAN}โ       ๐ GUรA COMPLETA - micro-ROS ESP32 ๐              โ${NC}"
echo -e "${CYAN}โ                                                           โ${NC}"
echo -e "${CYAN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  ESTADO DEL PROYECTO                                    โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "  ${GREEN}โ${NC} Cรณdigo modificado para funcionar como nodo ROS"
echo -e "  ${GREEN}โ${NC} Compilaciรณn exitosa (sin errores)"
echo -e "  ${GREEN}โ${NC} Sensor DS18B20 integrado"
echo -e "  ${GREEN}โ${NC} micro-ROS configurado"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  QUร HACE TU ESP32 AHORA                                โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "  ๐ก Actรบa como un ${CYAN}nodo ROS 2${NC} completo"
echo -e "  ๐ก๏ธ  Lee temperatura del sensor DS18B20"
echo -e "  ๐ Publica en el tรณpico ${CYAN}/temperatura${NC} cada 2 segundos"
echo -e "  ๐ Se comunica con el PC vรญa USB Serial"
echo -e "  ๐ค Compatible con todo el ecosistema ROS 2"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  PASO 1: FLASHEAR EL ESP32                             โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "  Opciรณn A - Script automรกtico:"
echo -e "    ${BLUE}./build_and_flash.sh${NC}"
echo ""
echo -e "  Opciรณn B - Manual:"
echo -e "    ${BLUE}source /home/lab-ros/esp/v5.5.2/esp-idf/export.sh${NC}"
echo -e "    ${BLUE}idf.py build flash monitor${NC}"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  PASO 2: INSTALAR micro-ROS AGENT (solo una vez)       โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "    ${BLUE}./install_microros_agent.sh${NC}"
echo ""
echo -e "  O manualmente:"
echo -e "    ${BLUE}sudo apt install ros-jazzy-micro-ros-agent${NC}"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  PASO 3: INICIAR EL AGENT (Terminal 1)                 โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "    ${BLUE}source /opt/ros/jazzy/setup.bash${NC}"
echo -e "    ${BLUE}ros2 run micro_ros_agent micro_ros_agent serial \\${NC}"
echo -e "    ${BLUE}         --dev /dev/ttyUSB0 -b 115200${NC}"
echo ""
echo -e "  ${GREEN}Cuando veas:${NC} \"โ Conectado al micro-ROS Agent!\""
echo -e "  ${GREEN}Significa que${NC} el ESP32 y el PC estรกn comunicados"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  PASO 4: VER DATOS ROS (Terminal 2)                    โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "    ${BLUE}source /opt/ros/jazzy/setup.bash${NC}"
echo ""
echo -e "  Ver nodos:"
echo -e "    ${BLUE}ros2 node list${NC}"
echo -e "    ${GREEN}โ /esp32_temp_sensor${NC}"
echo ""
echo -e "  Ver tรณpicos:"
echo -e "    ${BLUE}ros2 topic list${NC}"
echo -e "    ${GREEN}โ /temperatura${NC}"
echo ""
echo -e "  Escuchar temperatura:"
echo -e "    ${BLUE}ros2 topic echo /temperatura${NC}"
echo -e "    ${GREEN}โ data: 25.31${NC}"
echo -e "    ${GREEN}โ ---${NC}"
echo -e "    ${GREEN}โ data: 25.25${NC}"
echo ""
echo -e "  Ver frecuencia:"
echo -e "    ${BLUE}ros2 topic hz /temperatura${NC}"
echo -e "    ${GREEN}โ average rate: 0.500 (cada 2 segundos)${NC}"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  ARQUITECTURA DEL SISTEMA                               โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo "     โโโโโโโโโโโโโโ    Serial USB     โโโโโโโโโโโโโโโโ"
echo "     โ   ESP32    โ โโโโโโโโโโโโโโโโโโโ micro-ROS    โ"
echo "     โ  (Nodo ROS)โ   115200 baud     โ   Agent      โ"
echo "     โ            โ                   โ  (Puente)    โ"
echo "     โ DS18B20    โ                   โโโโโโโโฌโโโโโโโโ"
echo "     โ Sensor     โ                          โ"
echo "     โ 25.31ยฐC    โ                      DDS/UDP"
echo "     โ            โ                          โ"
echo "     โ Publica:   โ                          โผ"
echo "     โ/temperaturaโ                   โโโโโโโโโโโโโโโโ"
echo "     โโโโโโโโโโโโโโ                   โ  ROS 2 PC    โ"
echo "                                      โ  (Jazzy)     โ"
echo "                                      โ              โ"
echo "                                      โ โข Nodos      โ"
echo "                                      โ โข rqt_plot   โ"
echo "                                      โ โข rviz2      โ"
echo "                                      โโโโโโโโโโโโโโโโ"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  HERRAMIENTAS DISPONIBLES                               โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "  ๐ ${CYAN}README.md${NC} - Documentaciรณn completa"
echo -e "  ๐ ${CYAN}QUICKSTART.md${NC} - Inicio rรกpido (5 minutos)"
echo -e "  ๐ ${CYAN}USO_NODO_ROS.md${NC} - Guรญa detallada del nodo ROS"
echo -e "  ๐ง ${CYAN}build_and_flash.sh${NC} - Compilar y flashear"
echo -e "  ๐๏ธ  ${CYAN}microros_helper.sh${NC} - Menรบ interactivo"
echo -e "  ๐ฆ ${CYAN}install_microros_agent.sh${NC} - Instalar agent"
echo ""

echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${YELLOW}โ  SOLUCIรN DE PROBLEMAS                                  โ${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "  ${RED}No detecta sensor:${NC}"
echo -e "    โข Verificar conexiones fรญsicas"
echo -e "    โข Verificar resistencia pull-up 4.7kฮฉ"
echo ""
echo -e "  ${RED}No se conecta al Agent:${NC}"
echo -e "    โข Verificar que el Agent estรก corriendo"
echo -e "    โข Verificar puerto: ${BLUE}ls /dev/ttyUSB*${NC}"
echo -e "    โข Dar permisos: ${BLUE}sudo chmod 666 /dev/ttyUSB0${NC}"
echo ""
echo -e "  ${RED}No aparecen tรณpicos:${NC}"
echo -e "    โข Esperar conexiรณn (ver monitor ESP32)"
echo -e "    โข Reiniciar ESP32 (botรณn RESET)"
echo -e "    โข Verificar ROS_DOMAIN_ID=0"
echo ""

echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}โ                                                           โ${NC}"
echo -e "${GREEN}โ   โ TU ESP32 YA ES UN NODO ROS PROFESIONAL โ           โ${NC}"
echo -e "${GREEN}โ                                                           โ${NC}"
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

read -p "Presiona Enter para ejecutar el menรบ interactivo o Ctrl+C para salir..."

# Ejecutar el helper
./scripts/microros_helper.sh
